[
  {
    "number": 1,
    "title": "Test Login Successful",
    "url": "https://github.com/angelaantunes/devqa-ai/issues/1",
    "utilsCode": "/**\n * Perform login action on Swag Labs\n * @param {import('@playwright/test').Page} page\n * @param {string} username\n * @param {string} password\n */\nexport async function login(page, username, password) {\n  await page.fill('[data-test=\"username\"]', username);\n  await page.fill('[data-test=\"password\"]', password);\n  await page.click('[data-test=\"login-button\"]');\n}\n\n/**\n * Get error message text from login page\n * @param {import('@playwright/test').Page} page\n * @returns {Promise<string>}\n */\nexport async function getLoginErrorMessage(page) {\n  return await page.textContent('[data-test=\"error\"]');\n}\n\n/**\n * Clear both login fields\n * @param {import('@playwright/test').Page} page\n */\nexport async function clearLoginFields(page) {\n  await page.fill('[data-test=\"username\"]', '');\n  await page.fill('[data-test=\"password\"]', '');\n}",
    "playwrightCode": "import { test, expect } from '@playwright/test';\nimport { login } from './utils.js';\n\ntest.describe('Login negative paths @negative', () => {\n  const url = 'https://www.saucedemo.com/';\n  const inv = 'https://www.saucedemo.com/inventory.html';\n\n  test.beforeEach(async ({ page }) => {\n    await page.goto(url);\n  });\n\n  test('Empty username shows required error', async ({ page }) => {\n    await login(page, '', '');\n    await expect(page.locator('[data-test=\"error\"]')).toContainText('Username is required');\n    expect(page.url()).toBe(url);\n  });\n\n  test('Empty password shows required error', async ({ page }) => {\n    await login(page, 'standard_user', '');\n    await expect(page.locator('[data-test=\"error\"]')).toContainText('Password is required');\n    expect(page.url()).toBe(url);\n  });\n\n  test('Invalid credentials show generic error', async ({ page }) => {\n    await login(page, 'bad_user', 'wrongpass');\n    await expect(page.locator('[data-test=\"error\"]')).toContainText(\n      'Username and password do not match any user in this service'\n    );\n    expect(page.url()).toBe(url);\n  });\n\n  test('Locked out user shows lockout error', async ({ page }) => {\n    await login(page, 'locked_out_user', 'secret_sauce');\n    await expect(page.locator('[data-test=\"error\"]')).toContainText('Sorry, this user has been locked out.');\n    expect(page.url()).toBe(url);\n  });\n\n  test('Leading spaces in username treated as invalid', async ({ page }) => {\n    await login(page, ' standard_user', 'secret_sauce');\n    await expect(page.locator('[data-test=\"error\"]')).toContainText('do not match');\n  });\n\n  test('Trailing spaces in username treated as invalid', async ({ page }) => {\n    await login(page, 'standard_user ', 'secret_sauce');\n    await expect(page.locator('[data-test=\"error\"]')).toContainText('do not match');\n  });\n\n  test('Leading spaces in password treated as invalid', async ({ page }) => {\n    await login(page, 'standard_user', ' secret_sauce');\n    await expect(page.locator('[data-test=\"error\"]')).toContainText('do not match');\n  });\n\n  test('Trailing spaces in password treated as invalid', async ({ page }) => {\n    await login(page, 'standard_user', 'secret_sauce ');\n    await expect(page.locator('[data-test=\"error\"]')).toContainText('do not match');\n  });\n\n  test('SQL injection in username fails safely', async ({ page }) => {\n    await login(page, \"' OR 1=1 --\", 'anything');\n    await expect(page.locator('[data-test=\"error\"]')).toContainText('do not match');\n  });\n\n  test('XSS payload in username is escaped', async ({ page }) => {\n    const xss = '<script>alert(1)</script>';\n    await login(page, xss, 'anything');\n    await expect(page.locator('[data-test=\"error\"]')).toContainText('do not match');\n    // Ensure script tag is escaped\n    await expect(page.locator('body')).not.toContain('alert(1)', { timeout: 1000 });\n  });\n\n  test('Overlong username handled gracefully', async ({ page }) => {\n    const long = 'a'.repeat(1000);\n    await login(page, long, 'secret_sauce');\n    await expect(page.locator('[data-test=\"error\"]')).toContainText('do not match');\n  });\n\n  test('Overlong password handled gracefully', async ({ page }) => {\n    const long = 'b'.repeat(1000);\n    await login(page, 'standard_user', long);\n    await expect(page.locator('[data-test=\"error\"]')).toContainText('do not match');\n  });\n\n  test('Offline network shows user-friendly error', async ({ page, context }) => {\n    await context.setOffline(true);\n    await login(page, 'standard_user', 'secret_sauce');\n    // UI should still show error, not hang\n    await expect(page.locator('[data-test=\"error\"]')).toBeVisible();\n    await context.setOffline(false);\n  });\n\n  test('Double-click login sends only one request', async ({ page }) => {\n    await page.fill('[data-test=\"username\"]', '');\n    await page.fill('[data-test=\"password\"]', '');\n    const reqPromise = page.waitForRequest('**/*', { timeout: 2000 }).catch(() => null);\n    await page.dblclick('[data-test=\"login-button\"]');\n    const req = await reqPromise;\n    expect(req).toBeNull(); // no network call expected for empty fields\n    await expect(page.locator('[data-test=\"error\"]')).toContainText('Username is required');\n  });\n\n  test('Enter key triggers validation when fields empty', async ({ page }) => {\n    await page.fill('[data-test=\"username\"]', 'bad');\n    await page.fill('[data-test=\"password\"]', 'bad');\n    await page.press('[data-test=\"password\"]', 'Enter');\n    await expect(page.locator('[data-test=\"error\"]')).toContainText('do not match');\n  });\n\n  test('No sensitive data in sessionStorage after failure', async ({ page }) => {\n    await login(page, 'bad', 'bad');\n    const storage = await page.evaluate(() => window.sessionStorage.length);\n    expect(storage).toBe(0);\n  });\n});",
    "manualSteps": [
      "1. Navigate to https://www.saucedemo.com/",
      "2. Leave the Username field empty and click Login → verify error message “Epic sadface: Username is required” appears.",
      "3. Refresh the page, enter a valid username (standard_user) but leave Password empty and click Login → verify error message “Epic sadface: Password is required” appears.",
      "4. Refresh the page, enter an invalid username (e.g., bad_user) and invalid password (e.g., wrongpass) → click Login → verify error message “Epic sadface: Username and password do not match any user in this service” appears.",
      "5. Refresh the page, enter a locked-out user (locked_out_user) and correct password (secret_sauce) → click Login → verify error message “Epic sadface: Sorry, this user has been locked out.” appears.",
      "6. Refresh the page, enter username with leading spaces ( standard_user) and correct password → click Login → verify same invalid-credentials error as step 4.",
      "7. Refresh the page, enter username with trailing spaces (standard_user ) and correct password → click Login → verify same invalid-credentials error.",
      "8. Refresh the page, enter correct username but password with leading spaces ( secret_sauce) → click Login → verify invalid-credentials error.",
      "9. Refresh the page, enter correct username but password with trailing spaces (secret_sauce ) → click Login → verify invalid-credentials error.",
      "10. Refresh the page, enter SQL injection string in username (' OR 1=1 --) and any password → click Login → verify invalid-credentials error (no server crash).",
      "11. Refresh the page, enter XSS payload in username (<script>alert(1)</script>) and any password → click Login → verify payload is escaped and login fails safely.",
      "12. Refresh the page, paste a 1000-character random string into username → click Login → verify graceful error (no 500 page).",
      "13. Refresh the page, paste a 1000-character random string into password → click Login → verify graceful error.",
      "14. Open DevTools → Network tab → throttle network to offline → enter valid credentials → click Login → verify user-friendly error message (no spinner forever).",
      "15. (Edge) Refresh page, double-click Login button rapidly → verify only one login request is sent and error appears for empty fields.",
      "16. (Edge) Enter valid credentials, press Enter in password field → verify login fails with same errors when credentials are wrong.",
      "17. (Accessibility) Focus Username, press Tab, press Space → verify Login button is triggered and validation error appears for empty fields.",
      "18. (Security) After any failed login, open DevTools → Application → Session Storage → verify no sensitive data or tokens are stored."
    ]
  },
  {
    "number": 1,
    "scenario": "positive",
    "title": "Test Login Successful",
    "url": "https://github.com/angelaantunes/devqa-ai/issues/1",
    "filename": "login_with_standard_user_should_succeed.spec.js",
    "utilsCode": "export async function login(page, username, password) {\n  await page.fill('[data-test=\"username\"]', username);\n  await page.fill('[data-test=\"password\"]', password);\n  await page.click('[data-test=\"login-button\"]');\n}",
    "playwrightCode": "import { test, expect } from '@playwright/test';\nimport { login } from './utils.js';\n\ntest('Login with standard_user should succeed', async ({ page }) => {\n  await page.goto('https://www.saucedemo.com/');\n  await expect(page).toHaveTitle(/Swag Labs/);\n\n  await login(page, 'standard_user', 'secret_sauce');\n\n  await expect(page).toHaveURL('https://www.saucedemo.com/inventory.html');\n  await expect(page.locator('[data-test=\"title\"]')).toHaveText('Products');\n});",
    "manualSteps": [
      "Navigate to https://www.saucedemo.com/",
      "Verify the page title is 'Swag Labs'",
      "Locate the Username input field with placeholder 'Username'",
      "Enter the text 'standard_user' into the Username field",
      "Locate the Password input field with placeholder 'Password'",
      "Enter the text 'secret_sauce' into the Password field",
      "Click the 'Login' button",
      "Wait for the URL to change to https://www.saucedemo.com/inventory.html",
      "Verify the current page URL is https://www.saucedemo.com/inventory.html",
      "Verify the page now displays the text 'Products' in the header"
    ]
  },
  {
    "number": 1,
    "scenario": "negative",
    "title": "Test Login Successful",
    "url": "https://github.com/angelaantunes/devqa-ai/issues/1",
    "filename": "test_login_successful_negative.spec.js",
    "utilsCode": "export async function fillInput(page, selector, value) {\n  await page.fill(selector, value);\n}\n\nexport async function clickButton(page, selector) {\n  await page.click(selector);\n}\n\nexport async function getErrorMessage(page) {\n  const error = await page.locator('[data-test=\"error\"]').textContent();\n  return error?.trim();\n}\n\nexport async function isOnPage(page, url) {\n  return page.url() === url;\n}",
    "playwrightCode": "import { test, expect } from '@playwright/test';\nimport { fillInput, clickButton, getErrorMessage, isOnPage } from './utils.js';\n\ntest.describe('Login - Negative Path', () => {\n  test('should NOT reach inventory page with invalid credentials', async ({ page }) => {\n    await page.goto('https://www.saucedemo.com/');\n    await expect(page).toHaveTitle(/Swag Labs/);\n\n    await fillInput(page, 'input[placeholder=\"Username\"]', 'standard_user');\n    await fillInput(page, 'input[placeholder=\"Password\"]', 'secret_sauce');\n    await clickButton(page, 'input[type=\"submit\"]');\n\n    // Negative assertions\n    const reachedInventory = await isOnPage(page, 'https://www.saucedemo.com/inventory.html');\n    expect(reachedInventory).toBe(false);\n\n    const errorText = await getErrorMessage(page);\n    expect(errorText).toBeTruthy();\n\n    await page.screenshot({ path: 'negative-login-fail.png' });\n  });\n});",
    "manualSteps": [
      "Navigate to https://www.saucedemo.com/",
      "Verify the page title is 'Swag Labs'",
      "Locate the Username input field with placeholder 'Username'",
      "Enter the text 'standard_user' into the Username field",
      "Locate the Password input field with placeholder 'Password'",
      "Enter the text 'secret_sauce' into the Password field",
      "Click the 'Login' button",
      "Verify that the browser URL is NOT https://www.saucedemo.com/inventory.html (negative assertion)",
      "Verify that an error message element is present on the page",
      "Capture the error message text and confirm it is not empty",
      "Take a screenshot of the failed login attempt for evidence"
    ]
  },
  {
    "number": 2,
    "scenario": "positive",
    "title": "Test User Locked",
    "url": "https://github.com/angelaantunes/devqa-ai/issues/2",
    "filename": "test_user_locked_positive.spec.js",
    "utilsCode": "export async function loginWithCredentials(page, username, password) {\n  await page.fill('input[placeholder=\"Username\"]', username);\n  await page.fill('input[placeholder=\"Password\"]', password);\n  await page.click('input[type=\"submit\"]');\n}\n\nexport async function getErrorMessage(page) {\n  const errorLocator = page.locator('[data-test=\"error\"]');\n  await errorLocator.waitFor({ state: 'visible' });\n  return errorLocator.textContent();\n}",
    "playwrightCode": "import { test, expect } from '@playwright/test';\nimport { loginWithCredentials, getErrorMessage } from './utils.js';\n\ntest('Locked-out user sees correct error message', async ({ page }) => {\n  await page.goto('https://www.saucedemo.com/');\n  await loginWithCredentials(page, 'locked_out_user', 'secret_sauce');\n  const message = await getErrorMessage(page);\n  expect(message).toBe('Epic sadface: Sorry, this user has been locked out.');\n});",
    "manualSteps": [
      "Navigate to https://www.saucedemo.com/",
      "Wait until the login form is fully rendered",
      "Locate the Username input field by its placeholder text 'Username'",
      "Enter the exact text locked_out_user into the Username field",
      "Locate the Password input field by its placeholder text 'Password'",
      "Enter the exact text secret_sauce into the Password field",
      "Locate the Login button",
      "Click the Login button",
      "Wait for the error container to appear",
      "Assert that the error container is visible",
      "Assert that the error text is exactly Epic sadface: Sorry, this user has been locked out.",
      "Take a screenshot of the error for evidence (optional but recommended)",
      "Mark the test as passed if all assertions are true"
    ]
  },
  {
    "number": 6,
    "title": "Add the item to the checkout",
    "url": "https://github.com/angelaantunes/devqa-ai/issues/6",
    "utilsCode": "export async function addFirstItemToCart(page) {\n  const btn = page.locator('.inventory_item').first().locator('button:has-text(\"Add to cart\")');\n  await btn.click();\n  await expect(page.locator('.shopping_cart_badge')).toHaveText('1');\n}\n\nexport async function openCart(page) {\n  await page.click('.shopping_cart_container');\n  await expect(page).toHaveURL(/.*cart/i);\n}\n\nexport async function waitForCartLoaded(page) {\n  await expect(page.locator('.cart_item')).toBeVisible();\n}\n\nexport async function getCartBadgeCount(page) {\n  const badge = page.locator('.shopping_cart_badge');\n  if (!(await badge.isVisible())) return 0;\n  return parseInt(await badge.textContent(), 10);\n}\n\nexport async function getCartItemPrice(page) {\n  return page.locator('.cart_item .inventory_item_price').first().textContent();\n}\n\nexport async function interceptCart500(page) {\n  await page.route('**/cart', route => route.abort('failed'));\n}\n\nexport async function goOffline(page) {\n  await page.context().setOffline(true);\n}\n\nexport async function goOnline(page) {\n  await page.context().setOffline(false);\n}\n\nexport async function deleteCartStorage(page) {\n  await page.evaluate(() => {\n    localStorage.removeItem('cart-contents');\n    sessionStorage.removeItem('cart-contents');\n  });\n}\n\nexport async function changePriceInDOM(page, newPrice) {\n  await page.evaluate(p => {\n    document.querySelector('.inventory_item_price').textContent = `$${p.toFixed(2)}`;\n  }, newPrice);\n}",
    "playwrightCode": "import { test, expect } from '@playwright/test';\nimport { addFirstItemToCart, openCart, waitForCartLoaded, getCartBadgeCount, getCartItemPrice, interceptCart500, goOffline, goOnline, deleteCartStorage, changePriceInDOM } from './utils.js';\n\ntest.describe('Negative flow: Add first item to cart and validate checkout ($29.99)', () => {\n  test.beforeEach(async ({ page }) => {\n    await page.goto('/inventory.html', { waitUntil: 'networkidle' });\n    await expect(page.locator('.inventory_item')).toHaveCount(1);\n  });\n\n  test('double-click should not duplicate item', async ({ page }) => {\n    const btn = page.locator('.inventory_item').first().locator('button:has-text(\"Add to cart\")');\n    await btn.dblclick();\n    await expect(page.locator('.shopping_cart_badge')).toHaveText('1');\n  });\n\n  test('offline mode blocks cart navigation', async ({ page }) => {\n    await addFirstItemToCart(page);\n    await goOffline(page);\n    await openCart(page);\n    await expect(page.locator('.error-message')).toContainText(/offline|network/i);\n    await goOnline(page);\n  });\n\n  test('DOM price tampering reverts to $29.99', async ({ page }) => {\n    await addFirstItemToCart(page);\n    await changePriceInDOM(page, 0);\n    await page.reload();\n    await openCart(page);\n    await waitForCartLoaded(page);\n    const price = await getCartItemPrice(page);\n    expect(price).toBe('$29.99');\n  });\n\n  test('backend 500 on cart endpoint shows error', async ({ page }) => {\n    await interceptCart500(page);\n    await addFirstItemToCart(page);\n    await openCart(page);\n    await expect(page.locator('.error-message')).toContainText(/server|error/i);\n  });\n\n  test('cart is user-scoped across tabs', async ({ browser }) => {\n    const ctx1 = await browser.newContext();\n    const p1 = await ctx1.newPage();\n    await p1.goto('/inventory.html');\n    await addFirstItemToCart(p1);\n\n    const ctx2 = await browser.newContext();\n    const p2 = await ctx2.newPage();\n    await p2.goto('/inventory.html');\n    const badge = await getCartBadgeCount(p2);\n    expect(badge).toBe(0);\n\n    await ctx1.close();\n    await ctx2.close();\n  });\n\n  test('expired token redirects to login', async ({ page, context }) => {\n    await context.addInitScript(() => {\n      localStorage.setItem('session-ttl', new Date(Date.now() - 3600_000).toISOString());\n    });\n    await addFirstItemToCart(page);\n    await openCart(page);\n    await expect(page).toHaveURL(/.*login/i);\n  });\n\n  test('deleting cart storage shows empty cart', async ({ page }) => {\n    await addFirstItemToCart(page);\n    await deleteCartStorage(page);\n    await openCart(page);\n    await expect(page.locator('.cart_item')).toHaveCount(0);\n  });\n\n  test('invalid SKU does not add item', async ({ page }) => {\n    await page.evaluate(() => {\n      document.querySelector('.inventory_item button').dataset.itemId = 'INVALID';\n    });\n    await addFirstItemToCart(page);\n    const badge = await getCartBadgeCount(page);\n    expect(badge).toBe(0);\n  });\n});",
    "manualSteps": [
      "1. Open the browser and navigate to the inventory page (ensure the page is fully loaded).",
      "2. Verify that at least one inventory item is visible; if none are present, log a defect and stop the test.",
      "3. Locate the first inventory item card and identify its price (expected price: $29.99).",
      "4. Click the 'Add to cart' button on the first item and immediately verify that the button text changes to 'Remove'.",
      "5. Without navigating away, click the 'Add to cart' button again (double-click simulation) and confirm the app does not crash or add duplicate items.",
      "6. Disable network connectivity (offline mode) and click the shopping-cart icon; expect an appropriate error message or disabled state.",
      "7. Re-enable network connectivity and click the shopping-cart icon.",
      "8. On the checkout page, verify that the cart badge shows '1' and the item price is exactly $29.99 (not $29.98 or $30.00).",
      "9. Manually change the DOM to set the price to $0.00 and refresh the page; assert that the price reverts to $29.99 or an error is shown.",
      "10. Inject a backend 500 error for the cart endpoint and attempt to open the cart; verify a user-friendly error appears.",
      "11. Remove the item from the cart via the UI and confirm the cart badge disappears; then click browser back and forward buttons to ensure the cart remains empty.",
      "12. Add the item again, open a new browser tab, log in as a different user, and verify that the cart is user-scoped (i.e., empty for the second user).",
      "13. Set the system clock forward by 1 hour to simulate token expiry, then click the cart icon; expect redirection to login or an auth error.",
      "14. Using browser dev-tools, delete the cart cookie/localStorage key and click the cart icon; expect an empty cart or error state.",
      "15. Finally, attempt to add a non-existent item (manipulate the button’s data attribute to an invalid SKU) and confirm the app handles it gracefully without adding anything to the cart."
    ]
  }
]